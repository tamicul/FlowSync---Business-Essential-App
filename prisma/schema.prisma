generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  clerkId       String    @unique
  email         String    @unique
  name          String?
  avatar        String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  events        Event[]
  tasks         Task[]
  appointments  Appointment[]
  preferences   UserPreferences?
  energyPattern EnergyPattern?
  insights      AIInsight[]
}

model UserPreferences {
  id                    String   @id @default(uuid())
  userId                String   @unique
  user                  User     @relation(fields: [userId], references: [id])
  
  defaultWorkingHours   Json
  timezone              String   @default("America/New_York")
  weekStartsOn          Int      @default(1)
  
  emailNotifications    Boolean  @default(true)
  pushNotifications     Boolean  @default(true)
  smsNotifications      Boolean  @default(false)
  reminderDefault       Int      @default(15)
  
  aiSuggestions         Boolean  @default(true)
  autoSchedule          Boolean  @default(false)
  focusTimeBlocks       Boolean  @default(true)
  
  bookingEnabled        Boolean  @default(true)
  bufferBetweenMeetings Int      @default(15)
  minNoticeHours        Int      @default(24)
  maxBookingDays        Int      @default(30)
}

model EnergyPattern {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id])
  
  hourData    Json
  peakHours   Int[]
  lowHours    Int[]
  
  updatedAt   DateTime @updatedAt
}

model Event {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  
  title         String
  description   String?
  startTime     DateTime
  endTime       DateTime
  
  type          EventType @default(MEETING)
  priority      Priority  @default(MEDIUM)
  status        EventStatus @default(CONFIRMED)
  
  location      String?
  isVirtual     Boolean   @default(false)
  meetingLink   String?
  
  attendees     Attendee[]
  tasks         Task[]
  attachments   Attachment[]
  notes         Note[]
  
  isRecurring   Boolean   @default(false)
  recurrenceRule String?
  parentEventId String?
  
  aiPrep        Json?
  aiSummary     String?
  
  weather       Json?
  traffic       Json?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([userId])
  @@index([startTime])
}

model Attendee {
  id          String   @id @default(uuid())
  eventId     String
  event       Event    @relation(fields: [eventId], references: [id])
  
  email       String
  name        String?
  status      AttendeeStatus @default(PENDING)
  isOptional  Boolean  @default(false)
  
  @@index([eventId])
}

model Task {
  id            String     @id @default(uuid())
  userId        String
  user          User       @relation(fields: [userId], references: [id])
  
  title         String
  description   String?
  
  status        TaskStatus @default(TODO)
  priority      Priority   @default(MEDIUM)
  
  estimatedMinutes Int?
  actualMinutes    Int?
  
  energyRequired   Int?
  focusLevel       FocusLevel @default(MEDIUM)
  
  dueDate       DateTime?
  scheduledDate DateTime?
  eventId       String?
  event         Event?     @relation(fields: [eventId], references: [id])
  
  category      String?
  tags          String[]
  projectId     String?
  
  parentTaskId  String?
  
  attachments   Attachment[]
  completedAt   DateTime?
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  @@index([userId])
  @@index([status])
  @@index([dueDate])
}

model Appointment {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id])
  
  clientName      String
  clientEmail     String
  clientPhone     String?
  
  serviceType     String
  serviceName     String
  description     String?
  
  requestedDate   DateTime
  duration        Int
  status          AppointmentStatus @default(PENDING)
  
  price           Float?
  depositRequired Float?
  depositPaid     Boolean  @default(false)
  
  location        String?
  isVirtual       Boolean  @default(false)
  meetingLink     String?
  
  clientNotes     String?
  internalNotes   String?
  
  reminderSent    Boolean  @default(false)
  
  eventId         String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([userId])
  @@index([status])
}

model AIInsight {
  id              String      @id @default(uuid())
  userId          String
  user            User        @relation(fields: [userId], references: [id])
  
  type            InsightType
  category        String
  title           String
  message         String
  confidence      Float
  
  suggestedAction String?
  actionTaken     Boolean     @default(false)
  
  dismissed       Boolean     @default(false)
  createdAt       DateTime    @default(now())
  
  @@index([userId])
  @@index([createdAt])
}

model Attachment {
  id        String   @id @default(uuid())
  url       String
  name      String
  type      String
  size      Int
  
  eventId   String?
  event     Event?   @relation(fields: [eventId], references: [id])
  taskId    String?
  task      Task?    @relation(fields: [taskId], references: [id])
  
  createdAt DateTime @default(now())
}

model Note {
  id        String   @id @default(uuid())
  eventId   String
  event     Event    @relation(fields: [eventId], references: [id])
  
  content   String
  type      NoteType @default(TEXT)
  createdBy String
  
  createdAt DateTime @default(now())
  
  @@index([eventId])
}

enum EventType {
  MEETING
  FOCUS_TIME
  TASK_BLOCK
  BREAK
  APPOINTMENT
  REMINDER
  TRAVEL
}

enum EventStatus {
  CONFIRMED
  TENTATIVE
  CANCELLED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  DONE
  CANCELLED
}

enum FocusLevel {
  LOW
  MEDIUM
  HIGH
  DEEP
}

enum AttendeeStatus {
  PENDING
  ACCEPTED
  DECLINED
  TENTATIVE
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  RESCHEDULED
  CANCELLED
  COMPLETED
  NO_SHOW
}

enum InsightType {
  TIP
  WARNING
  SUGGESTION
  ALERT
  CELEBRATION
}

enum NoteType {
  TEXT
  AUDIO
  ACTION_ITEM
  DECISION
}